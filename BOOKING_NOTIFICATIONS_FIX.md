# ุฅุตูุงุญ ูุดููุฉ ุงูุญุฌุฒ ูุงูุฅุดุนุงุฑุงุช

## ุงููุดููุฉ ุงูุชู ุชู ุฅุตูุงุญูุง:
1. **ุงูุญุฌุฒ ูุง ูุชู ูุนููุงู** - ูุงู ููุงู ุนุฏู ุชุฃููุฏ ูู ูุฌุงุญ ุงูุนูููุฉ
2. **ูุง ูุชู ุฅุดุนุงุฑ ุงูุทุจูุจ** - ูู ููู ููุงู ูุธุงู ุฅุดุนุงุฑุงุช ุนูุฏ ุฅูุดุงุก ููุนุฏ ุฌุฏูุฏ

## ุงูุญููู ุงููุทุจูุฉ:

### 1. ุชุญุณูู ุนูููุฉ ุงูุญุฌุฒ (`lib/ai/chat-functions.ts`):

#### โ ุงูุชุญูู ูู ูุฌุงุญ ุงูุญุฌุฒ:
```typescript
if (error || !appointment) {
  console.error("Error creating appointment:", error);
  return {
    success: false,
    message: `ูุดู ูู ุญุฌุฒ ุงูููุนุฏ: ${error?.message || "ุญุฏุซ ุฎุทุฃ ุบูุฑ ูุชููุน"}`,
  };
}

// ุงูุชุฃูุฏ ูู ุฃู ุงูููุนุฏ ุชู ุฅูุดุงุคู ุจุงููุนู
console.log("โ Appointment created successfully:", appointment.id);
```

#### โ ุฅุถุงูุฉ ุฅุดุนุงุฑ ููุทุจูุจ:
ุจุนุฏ ูุฌุงุญ ุงูุญุฌุฒุ ูุชู ุฅูุดุงุก ุฑุณุงูุฉ ูู ุฌุฏูู `messages` ูุฅุดุนุงุฑ ุงูุทุจูุจ:

```typescript
// ุฅูุดุงุก ุฑุณุงูุฉ/ุฅุดุนุงุฑ ููุทุจูุจ ุนู ุงูููุนุฏ ุงูุฌุฏูุฏ
const { error: messageError } = await supabase
  .from("messages")
  .insert({
    sender_id: userId,           // ุงููุฑูุถ
    recipient_id: doctorId,       // ุงูุทุจูุจ
    appointment_id: appointment.id,
    body: `ูุฏูู ุทูุจ ุญุฌุฒ ููุนุฏ ุฌุฏูุฏ ูู ${patientName}. ุงูุชุงุฑูุฎ: ${formattedDate}. ููุน ุงูุงุณุชุดุงุฑุฉ: ${mode}. ุงูุณุจุจ: ${reason}`,
    metadata: {
      type: "appointment_request",
      appointment_id: appointment.id,
      action_required: "review_appointment",
    },
  });
```

### 2. ูุนูููุงุช ุงูุฅุดุนุงุฑ:
- **ุงููุฑุณู**: ุงููุฑูุถ (user_id)
- **ุงููุณุชูุจู**: ุงูุทุจูุจ (doctor_id)
- **ุงููุญุชูู**: ุชูุงุตูู ุงูููุนุฏ (ุงูุชุงุฑูุฎุ ุงูููุชุ ููุน ุงูุงุณุชุดุงุฑุฉุ ุงูุณุจุจ)
- **Metadata**: ููุน ุงูุฅุดุนุงุฑ ูID ุงูููุนุฏ ูุทูุจ ูุฑุงุฌุนุฉ

### 3. ุฑุณุงูุฉ ุงููุฌุงุญ ุงููุญุณููุฉ:
```
ุชู ุญุฌุฒ ุงูููุนุฏ ุจูุฌุงุญ ูุน [ุงุณู ุงูุทุจูุจ]! 
ุชุงุฑูุฎ ุงูููุนุฏ: [ุงูุชุงุฑูุฎ]. 
ุชู ุฅุฑุณุงู ุฅุดุนุงุฑ ููุทุจูุจ ูุณูุชู ูุฑุงุฌุนุฉ ุงูุทูุจ ูุงูุงูุชุธุงุฑ ููููุงููุฉ ุนูู ุงูููุนุฏ.
```

## ููููุฉ ุงูุชุญูู ูู ุงูุฅุดุนุงุฑุงุช:

### ููุทุจูุจ:
1. ุชุณุฌูู ุงูุฏุฎูู ุจุญุณุงุจ ุงูุทุจูุจ
2. ุงูุงูุชูุงู ุฅูู ุตูุญุฉ **ุงูููุงุนูุฏ** (`/appointments`)
3. ุณูุธูุฑ ุงูููุนุฏ ุงูุฌุฏูุฏ ูู ุชุจููุจ **"ููุฏ ุงูุงูุชุธุงุฑ" (pending)**
4. ูููู ููุทุจูุจ ุฃูุถุงู ุนุฑุถ ุงูุฑุณุงุฆู ูู ูุธุงู ุงูุฑุณุงุฆู (ุฅุฐุง ูุงู ููุฌูุฏุงู)

### ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช:
```sql
-- ุนุฑุถ ุงูููุงุนูุฏ ุงููุนููุฉ ููุทุจูุจ
SELECT * FROM appointments 
WHERE doctor_id = '[doctor_id]' 
AND status = 'pending'
ORDER BY created_at DESC;

-- ุนุฑุถ ุงูุฅุดุนุงุฑุงุช ุงููุฑุณูุฉ ููุทุจูุจ
SELECT * FROM messages 
WHERE recipient_id = '[doctor_id]' 
AND metadata->>'type' = 'appointment_request'
ORDER BY created_at DESC;
```

## Logging ููุชุดุฎูุต:
ุชู ุฅุถุงูุฉ logging ุดุงูู ูู:
- โ ูุฌุงุญ/ูุดู ุฅูุดุงุก ุงูููุนุฏ
- โ ูุฌุงุญ/ูุดู ุฅูุดุงุก ุงูุฅุดุนุงุฑ
- โ ุชูุงุตูู ุงูููุนุฏ ุงููููุดุฃ

ููููู ูุฑุงุฌุนุฉ ุงูู logs ูู:
- Server logs (Terminal where `npm run dev` is running)
- Browser console (for client-side errors)

## ููุงุญุธุงุช ูููุฉ:
1. **ุงูุฅุดุนุงุฑุงุช ุบูุฑ ุงููุงุดูุฉ ูุง ุชููู ุงูุญุฌุฒ**: ุฅุฐุง ูุดู ุฅูุดุงุก ุงูุฅุดุนุงุฑุ ุณูุชู ุฅูุดุงุก ุงูููุนุฏ ููู ุจุฏูู ุฅุดุนุงุฑ (ูุถูุงู ุนุฏู ููุฏุงู ุทูุจ ุงูุญุฌุฒ)
2. **Metadata ููุฅุดุนุงุฑุงุช**: ูุชู ุญูุธ ููุน ุงูุฅุดุนุงุฑ ูู `metadata.type` ูุชุณููู ุงูููุชุฑุฉ ูุงูุนุฑุถ
3. **ุงูุชูุงูู ูุน ุงููุธุงู ุงูุญุงูู**: ูุณุชุฎุฏู ุฌุฏูู `messages` ุงูููุฌูุฏ ุจุงููุนู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

## ุงูุฎุทูุงุช ุงูุชุงููุฉ ุงูููุชุฑุญุฉ:
1. โ **ููุชูู**: ุฅุดุนุงุฑ ุงูุทุจูุจ ุนูุฏ ุฅูุดุงุก ููุนุฏ
2. ๐ **ููุฏ ุงูุชุทููุฑ**: ุนุฑุถ ุงูุฅุดุนุงุฑุงุช ูู ููุญุฉ ุชุญูู ุงูุทุจูุจ
3. ๐ง **ูุณุชูุจูู**: ุฅุดุนุงุฑุงุช ุจุฑูุฏ ุฅููุชุฑููู ููุทุจูุจ
4. ๐ฑ **ูุณุชูุจูู**: ุฅุดุนุงุฑุงุช Push ููุทุจูุจ

---

**ุชุงุฑูุฎ ุงูุชุญุฏูุซ**: ุงูููู
**ุงูุญุงูุฉ**: โ ุชู ุงูุฅุตูุงุญ ูุงูุชุทุจูู




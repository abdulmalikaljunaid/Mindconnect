# معلومات الجلسة (Session Information)

## نظرة عامة

تم إضافة نظام شامل لإدارة ومراقبة جلسات تسجيل الدخول في التطبيق. هذا النظام يساعد في:
- معرفة متى تنتهي الجلسة
- تحديث الجلسة تلقائياً قبل انتهائها
- إشعار المستخدم قبل انتهاء الجلسة
- عرض معلومات مفصلة عن حالة الجلسة

## مدة الجلسة

- **المدة الافتراضية**: ساعة واحدة (3600 ثانية) من آخر نشاط
- **التحديث التلقائي**: يتم تحديث الجلسة تلقائياً قبل انتهائها بـ 5 دقائق
- **التحقق الدوري**: يتم التحقق من حالة الجلسة كل دقيقتين

## المكونات المضافة

### 1. Hook: `useSessionInfo`
يحتوي على معلومات الجلسة الحالية:
- وقت انتهاء الجلسة
- الوقت المتبقي حتى انتهاء الجلسة
- حالة الجلسة (نشطة، ستنتهي قريباً، منتهية)
- تنسيق الوقت المتبقي بشكل مقروء

### 2. Component: `SessionInfo`
مكون لعرض معلومات الجلسة في واجهة المستخدم:
- يعرض الوقت المتبقي حتى انتهاء الجلسة
- يعرض تاريخ ووقت انتهاء الجلسة
- يظهر تحذيرات عند اقتراب انتهاء الجلسة
- يحتوي على زر لتحديث الجلسة يدوياً

### 3. Hook: `useSessionExpiryNotification`
يرسل إشعارات للمستخدم:
- إشعار قبل 5 دقائق من انتهاء الجلسة
- إشعار عند انتهاء الجلسة

### 4. تحسينات على `useSessionRefresh`
- تحديث الجلسة تلقائياً قبل انتهائها
- معالجة أفضل للجلسات المنتهية
- سجلات أفضل لتتبع عملية التحديث

## كيفية الاستخدام

### عرض معلومات الجلسة

يمكنك عرض معلومات الجلسة في أي صفحة باستخدام:

```tsx
import { SessionInfo } from "@/components/session-info"

export default function MyPage() {
  return (
    <div>
      <SessionInfo />
    </div>
  )
}
```

### استخدام Hook معلومات الجلسة

```tsx
import { useSessionInfo } from "@/hooks/use-session-info"

export default function MyComponent() {
  const sessionInfo = useSessionInfo()
  
  return (
    <div>
      <p>الوقت المتبقي: {sessionInfo.formattedTimeRemaining}</p>
      {sessionInfo.isExpiringSoon && (
        <p>تحذير: الجلسة ستنتهي قريباً!</p>
      )}
    </div>
  )
}
```

## الموقع

تم إضافة مكون `SessionInfo` في صفحة الإعدادات (`/settings`) في تبويب "الأمان".

## آلية العمل

1. **التحقق الدوري**: يتم التحقق من حالة الجلسة كل 10 ثوانٍ
2. **التحديث التلقائي**: عند اقتراب انتهاء الجلسة (أقل من 5 دقائق)، يتم تحديثها تلقائياً
3. **الإشعارات**: يتم إرسال إشعار للمستخدم قبل 5 دقائق من انتهاء الجلسة
4. **التحديث اليدوي**: يمكن للمستخدم تحديث الجلسة يدوياً من خلال زر في مكون `SessionInfo`

## حل المشاكل الشائعة

### الجلسة تنتهي بسرعة
- تأكد من أن التحديث التلقائي يعمل بشكل صحيح
- تحقق من أن `useSessionRefresh` يعمل في `AuthProvider`
- تأكد من أن المستخدم لديه اتصال إنترنت مستقر

### لا تظهر معلومات الجلسة
- تأكد من أن المستخدم مسجل دخول
- تحقق من أن `SessionInfo` موجود في الصفحة
- تحقق من console للأخطاء

### الإشعارات لا تظهر
- تأكد من أن `useSessionExpiryNotification` مستخدم في `AuthProvider`
- تحقق من أن جدول `notifications` موجود في قاعدة البيانات
- تحقق من أن المستخدم لديه صلاحيات لإنشاء إشعارات

## ملاحظات مهمة

- الجلسة يتم تحديثها تلقائياً، لكن يجب على المستخدم أن يكون نشطاً (يستخدم التطبيق)
- إذا كان المستخدم غير نشط لفترة طويلة، قد تنتهي الجلسة
- التحديث التلقائي يعمل فقط عندما يكون التطبيق مفتوحاً ونشطاً


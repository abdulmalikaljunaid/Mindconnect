# إعداد الحسابات الإدارية - دليل المطور

## 🔒 الأمان

تم تطبيق حماية متعددة المستويات لمنع إنشاء حسابات إدارية غير مصرح بها:

### 1. حماية قاعدة البيانات
- تم تعديل دالة `handle_new_user()` في Supabase لمنع إنشاء حسابات إدارية من خلال التسجيل العادي
- أي محاولة لإنشاء حساب إداري ستؤدي إلى خطأ

### 2. حماية الواجهة الأمامية
- تم تعطيل خيار "إداري" في صفحة التسجيل
- تم إضافة فحص في `authService.signUp()` لمنع إنشاء حسابات إدارية

### 3. حماية الخدمة
- تم إنشاء وظائف آمنة في `lib/admin-setup.ts` تتطلب سر إداري

## 🛠️ كيفية إنشاء حساب إداري

### الخطوة 1: إعداد متغير البيئة
أضف السر الإداري إلى ملف `.env.local`:

```bash
# السر الإداري لإنشاء حسابات إدارية (للمطورين فقط)
ADMIN_CREATION_SECRET=your-super-secret-admin-key-here
```

### الخطوة 2: استخدام صفحة الإعداد الآمنة
1. اذهب إلى `/admin-setup`
2. أدخل السر الإداري
3. املأ بيانات الحساب الإداري الجديد
4. انقر على "إنشاء حساب إداري"

### الخطوة 3: ترقية مستخدم موجود (اختياري)
إذا كنت تريد ترقية مستخدم موجود إلى إداري:
1. احصل على معرف المستخدم (UUID) من قاعدة البيانات
2. استخدم قسم "ترقية مستخدم موجود" في صفحة الإعداد

## 🔧 الوظائف المتاحة

### `createAdminAccount(email, password, name, adminSecret)`
إنشاء حساب إداري جديد من الصفر

### `promoteToAdmin(userId, adminSecret)`
ترقية مستخدم موجود إلى إداري

### `listAdmins(adminSecret)`
عرض قائمة بجميع الإداريين

## ⚠️ تحذيرات مهمة

1. **لا تشارك السر الإداري** مع أي شخص غير مصرح له
2. **غيّر السر الإداري** في بيئة الإنتاج
3. **احذف صفحة الإعداد** من الإنتاج أو احمها بكلمة مرور إضافية
4. **راقب الحسابات الإدارية** بانتظام

## 🚀 للإنتاج

في بيئة الإنتاج، يُنصح بـ:
1. استخدام سر إداري قوي ومعقد
2. حماية صفحة `/admin-setup` بكلمة مرور إضافية
3. مراقبة إنشاء الحسابات الإدارية
4. إزالة صفحة الإعداد بعد إنشاء الحسابات المطلوبة

## 📝 مثال على الاستخدام

```typescript
import { createAdminAccount } from '@/lib/admin-setup'

// إنشاء حساب إداري جديد
const admin = await createAdminAccount(
  'admin@company.com',
  'secure-password-123',
  'أحمد الإداري',
  process.env.ADMIN_CREATION_SECRET!
)
```

## 🔍 التحقق من الأمان

للتأكد من أن الحماية تعمل:
1. حاول إنشاء حساب إداري من صفحة التسجيل العادية - يجب أن تفشل
2. حاول استخدام وظائف الإعداد بدون السر الصحيح - يجب أن تفشل
3. تحقق من قاعدة البيانات أن الحسابات الإدارية فقط هي التي تم إنشاؤها

